@if(areAllMatchesCompleted()) {
    <button class="btn primary" (click)="openModal()">Complete Group Stage</button>
}
<div class="tournament-view">
    <div class="groups-container">
        <div *ngFor="let group of tournament.groups" class="group">
            <h2>Group {{ group.id + 1 }}</h2>

            <!-- Matrix-style results table -->
            <div class="matrix-table-container">
                <table class="matrix-table">
                    <thead>
                        <tr>
                            <th class="player-header">LP.</th>
                            <th class="player-header">Uczestnik</th>
                            <th *ngFor="let i of [1, 2, 3, 4, 5, 6]">{{ i }}</th>
                            <th>Pkt.</th>
                            <th>Bilans</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let player1 of group.players; let i = index">
                            <td class="rank">{{ i + 1 }}</td>
                            <td class="player-name">{{ player1.name }}</td>
                            <td *ngFor="let player2 of group.players; let j = index" [class.match-cell]="player1.id !== player2.id" [class.diagonal]="player1.id === player2.id">
                                <ng-container *ngIf="player1.id !== player2.id">
                                    <ng-container *ngIf="
                        getMatchResult(group, player1, player2) as result
                      ">
                                        <div *ngIf="result.match" class="match-result" [class.completed]="result.match.completed">
                                            <ng-container *ngIf="
                            !result.match.completed ||
                            editingMatch === result.match
                          ">
                                                <div class="match-input">
                                                    <input type="number" [(ngModel)]="result.match.player1Score" class="score-input" /> :
                                                    <input type="number" [(ngModel)]="result.match.player2Score" class="score-input" />
                                                    <button (click)="submitResult(result.match)" class="btn-small" [disabled]="!isValidScore(result.match)">
                              âœ“
                            </button>
                                                </div>
                                            </ng-container>
                                            <div *ngIf="
                            result.match.completed &&
                            editingMatch !== result.match
                          " (dblclick)="startEditing(result.match)">
                                                {{ result.score }}
                                            </div>
                                        </div>
                                    </ng-container>
                                </ng-container>
                            </td>
                            <td class="points">{{ getPlayerPoints(group, player1) }}</td>
                            <td class="balance">
                                {{ getPlayerBalance(group, player1) }}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <mat-accordion>
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>
                            Panel 1 Title
                        </mat-panel-title>
                        <mat-panel-description>
                            Click to expand
                        </mat-panel-description>
                    </mat-expansion-panel-header>
                    <div class="matches">
                        <div *ngFor="let match of group.matches" class="match" [class.completed]="match.completed">
                            <div class="match-header">
                                <span>{{ match.player1.name }} vs {{ match.player2.name }}</span
                      >
                      <div class="match-controls">
                        <div
                          *ngIf="match.completed"
                          class="match-score"
                          (dblclick)="startEditing(match)"
                        >
                          {{ match.player1Score }} : {{ match.player2Score }}
                        </div>
                        <button
                          (click)="match.showStats = !match.showStats"
                          class="btn-small"
                          [class.active]="match.showStats"
                        >
                          Stats
                        </button>
                      </div>
                    </div>
                    <div *ngIf="match.showStats" class="match-stats">
                      <div class="player-stats">
                        <h5>{{ match.player1.name }}</h5>
                        <div class="stat-inputs">
                          <div class="stat-input">
                            <label>180s:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player1Stats!.count180s"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>171s:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player1Stats!.count171s"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>HF:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player1Stats!.highestFinish"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>BL:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player1Stats!.bestLeg"
                              class="stat-number-input"
                            />
                          </div>
                        </div>
                      </div>
                      <div class="player-stats">
                        <h5>{{ match.player2.name }}</h5>
                        <div class="stat-inputs">
                          <div class="stat-input">
                            <label>180s:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player2Stats!.count180s"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>171s:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player2Stats!.count171s"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>HF:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player2Stats!.highestFinish"
                              class="stat-number-input"
                            />
                          </div>
                          <div class="stat-input">
                            <label>BL:</label>
                            <input
                              type="number"
                              [(ngModel)]="match.player2Stats!.bestLeg"
                              class="stat-number-input"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>


                </mat-expansion-panel>
            </mat-accordion>
        </div>

            <!-- Match Statistics -->

            <!-- Sequential Matches List -->
            <div *ngIf="showMatchesList" class="sequential-matches">
                <h2>All Matches</h2>
                <div class="matches-container">
                    <div *ngFor="let match of getAllGroupMatchesSorted()" class="match-item" [class.completed]="match.completed">
                        <div class="match-header">
                            <span class="group-label">Group {{ match.groupId! + 1 }}</span>
                                <span class="player-position">
              {{ getPlayerGroupPosition(match.player1, match.groupId!) }}
              vs
              {{ getPlayerGroupPosition(match.player2, match.groupId!) }}
            </span>
                            </div>
                            <div class="match-score">
                                <div class="player-name">{{ match.player1.name }}</div>
                                <div *ngIf="!match.completed || editingMatch === match" class="match-input">
                                    <input type="number" [(ngModel)]="match.player1Score" class="score-input" placeholder="0" /> :
                                    <input type="number" [(ngModel)]="match.player2Score" class="score-input" placeholder="0" />
                                    <button (click)="submitResult(match)" class="btn-small" [disabled]="!isValidScore(match)">
                Zakoncz
              </button>
                                </div>
                                <div *ngIf="match.completed && editingMatch !== match" class="match-result" (dblclick)="startEditing(match)">
                                    {{ match.player1Score }} : {{ match.player2Score }}
                                </div>
                                <div class="player-name">{{ match.player2.name }}</div>
                            </div>
                        </div>
                    </div>
        </div>
    </div>
</div>